<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Dataset Report — {{ dataset_id }}</title>
    <link rel="stylesheet" href="{{ static_url }}reports/report.css">
  </head>
  <body>
    <header class="cover">
      <h1>Chemical Equipment — Dataset Report</h1>
      <div class="meta">
        <div><strong>Dataset:</strong> {{ dataset_id }}</div>
        <div><strong>Rows:</strong> {{ rows }}</div>
        <div><strong>Generated:</strong> {{ generated_at }}</div>
        {% if user %}
        <div><strong>Requested by:</strong> {{ user }}</div>
        {% endif %}
      </div>
    </header>

    <section class="summary">
      <h2>Quick Summary</h2>
      <p><strong>Columns:</strong> {{ columns|join:", " }}</p>
      <div class="keys">
        {% for col in numeric_columns %}
        <div class="key">
          <strong>{{ col }}:</strong>
          mean={{ summary[col].mean }}, min={{ summary[col].min }}, max={{ summary[col].max }}
        </div>
        {% endfor %}
      </div>
    </section>

    <section class="stats">
      <h2>Descriptive statistics</h2>
      <table class="stats-table">
        <thead>
          <tr>
            <th>Column</th>
            <th>count</th><th>mean</th><th>median</th><th>std</th><th>min</th><th>max</th>
          </tr>
        </thead>
        <tbody>
          {% for col in numeric_columns %}
          <tr>
            <td>{{ col }}</td>
            <td>{{ summary[col].count }}</td>
            <td>{{ summary[col].mean }}</td>
            <td>{{ summary[col].median }}</td>
            <td>{{ summary[col].std }}</td>
            <td>{{ summary[col].min }}</td>
            <td>{{ summary[col].max }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </section>

    <section class="charts">
      <h2>Charts</h2>
      {% for chart in charts %}
        <div class="chart">
          <h3>{{ chart.title }}</h3>
          <img src="data:image/png;base64,{{ chart.image_b64 }}" alt="{{ chart.title }}" />
          <p class="caption">{{ chart.caption }}</p>
        </div>
      {% endfor %}
    </section>

    <section class="preview">
      <h2>Data preview (first {{ preview|length }} rows)</h2>
      <table class="preview-table">
        <thead>
          <tr>
            {% for c in preview[0].keys %}
            <th>{{ c }}</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for r in preview %}
          <tr>
            {% for v in r.values %}
            <td>{{ v }}</td>
            {% endfor %}
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </section>

    <footer>
      <small>Generated by Chemical Equipment Visualizer</small>
    </footer>
  </body>
</html>
